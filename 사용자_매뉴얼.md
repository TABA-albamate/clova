# CLOVA OCR + Google Calendar 자동 등록 시스템 사용 설명서

## 📋 목차
1. [시스템 개요](#시스템-개요)
2. [사전 준비사항](#사전-준비사항)
3. [설치 및 설정](#설치-및-설정)
4. [사용 방법](#사용-방법)
5. [근무일정표 형식](#근무일정표-형식)
6. [문제 해결](#문제-해결)
7. [자주 묻는 질문](#자주-묻는-질문)

---

## 🎯 시스템 개요

이 시스템은 **근무일정표 이미지**를 업로드하면 자동으로 분석하여 **Google Calendar에 일정을 등록**해주는 도구입니다.

### 주요 기능
- 📸 근무일정표 이미지 업로드
- 🔍 CLOVA OCR로 텍스트 자동 추출
- 📅 Google Calendar에 일정 자동 등록
- 👤 특정 직원의 일정만 선택적 등록

---

## ⚙️ 사전 준비사항

### 1. 필요한 계정
- **네이버 계정** (CLOVA OCR 사용용)
- **Google 계정** (Calendar 연동용)

### 2. 필요한 파일
- `credentials.json` (Google OAuth 설정 파일)
- 근무일정표 이미지 파일 (JPG, PNG 등)

### 3. 시스템 요구사항
- Python 3.7 이상
- 인터넷 연결
- Windows/Mac/Linux

---

## 🔧 설치 및 설정

### 1단계: Python 패키지 설치
```bash
pip install flask google-auth-oauthlib google-auth-httplib2 google-api-python-client requests
```

### 2단계: Google Cloud Console 설정
1. **Google Cloud Console** 접속: https://console.cloud.google.com/
2. **프로젝트 생성** 또는 기존 프로젝트 선택
3. **Google Calendar API 활성화**:
   - 왼쪽 메뉴 → "API 및 서비스" → "라이브러리"
   - "Google Calendar API" 검색 후 활성화
4. **OAuth 동의 화면 설정**:
   - "API 및 서비스" → "OAuth 동의 화면"
   - 사용자 유형: "외부" 선택
   - 앱 이름, 사용자 지원 이메일 입력
5. **OAuth 클라이언트 ID 생성**:
   - "API 및 서비스" → "사용자 인증 정보"
   - "사용자 인증 정보 만들기" → "OAuth 클라이언트 ID"
   - 애플리케이션 유형: "웹 애플리케이션"
   - 승인된 리디렉션 URI: `http://127.0.0.1:5000/oauth2callback`
6. **credentials.json 다운로드**:
   - 생성된 OAuth 클라이언트 ID 옆 다운로드 버튼 클릭
   - `clova/credentials.json`으로 저장

### 3단계: CLOVA OCR 설정
1. **네이버 클라우드 플랫폼** 접속: https://www.ncloud.com/
2. **CLOVA OCR 서비스 신청**:
   - AI·NAVER API → CLOVA OCR
   - "일반 텍스트 인식" 또는 "표 인식" 선택
3. **API 키 확인**:
   - Console → AI·NAVER API → CLOVA OCR
   - 인증 정보 관리 → API Gateway → 인증 정보 확인
4. **auto_server.py 수정**:
   ```python
   CLOVA_URL = "https://[YOUR_DOMAIN]/custom/v1/[SERVICE_ID]/[MODEL_ID]/general"
   CLOVA_SECRET = "YOUR_API_SECRET_KEY"
   ```

---

## 🚀 사용 방법

### 1단계: 서버 실행

#### Google OAuth 인증 서버 실행
```bash
python clova/app.py
```
- 브라우저에서 `http://127.0.0.1:5000` 접속
- "📆 구글 캘린더 연결" 클릭
- Google 로그인 및 권한 승인
- 인증 완료 후 `http://127.0.0.1:5000/get-token`에서 access_token 복사

#### 일정 자동 등록 서버 실행
```bash
python clova/auto_server.py
```
- 서버가 `http://127.0.0.1:5001`에서 실행됨

### 2단계: Postman으로 API 호출

#### Postman 설정
- **Method**: `POST`
- **URL**: `http://localhost:5001/upload-image`
- **Body**: `form-data`

#### Body 필드 설정
| Key | Type | Value |
|-----|------|-------|
| `image` | File | 근무일정표 이미지 파일 선택 |
| `access_token` | Text | Google OAuth에서 받은 access_token |
| `name` | Text | 찾을 직원 이름 (예: "김지성") |

### 3단계: 결과 확인
- **성공 시**: JSON 응답으로 등록된 일정 정보 확인
- **Google Calendar**: 자동으로 등록된 일정 확인

---

## 📊 근무일정표 형식

### 권장 형식
```
날짜    | 7월 8일 | 7월 9일 | 7월 10일
포지션  | 포지션1 | 포지션2 | 포지션3
09:00   | 김지성  |         | 
10:00   | 김지성  |         | 
11:00   |         | 김지성  | 
12:00   |         | 김지성  | 
```

### 지원하는 시간 형식
- **HH:MM**: 09:00, 14:30
- **HH.M**: 13.5 (13:30으로 변환)
- **HH**: 18 (18:00으로 변환)

### 주의사항
- **날짜 행**: "날짜"로 시작해야 함
- **포지션 행**: "포지션"으로 시작해야 함
- **시간 행**: HH:MM 형식으로 시작해야 함
- **직원명**: 정확히 입력된 이름과 일치해야 함

---

## 🔧 문제 해결

### 1. 서버 연결 오류
**증상**: `ECONNREFUSED 127.0.0.1:5001`
**해결**: 
- `auto_server.py`가 실행 중인지 확인
- 포트 5001이 사용 중인지 확인: `netstat -ano | findstr :5001`

### 2. Google OAuth 오류
**증상**: `redirect_uri_mismatch`
**해결**:
- Google Cloud Console에서 리디렉션 URI 확인
- `http://127.0.0.1:5000/oauth2callback` 정확히 설정

### 3. CLOVA OCR 오류
**증상**: `ConnectTimeout` 또는 `500 Internal Server Error`
**해결**:
- 네이버 클라우드 콘솔에서 서비스 활성화 상태 확인
- API 키와 엔드포인트 URL 확인
- 사용량 초과 여부 확인

### 4. 일정 추출 실패
**증상**: 빈 결과 또는 잘못된 일정
**해결**:
- 근무일정표 형식 확인
- 직원명 정확성 확인
- 이미지 품질 확인 (선명하고 읽기 쉬운 이미지)

---

## ❓ 자주 묻는 질문

### Q1: 여러 직원의 일정을 한 번에 등록할 수 있나요?
**A**: 현재는 한 번에 한 명의 직원만 선택 가능합니다. 여러 직원을 등록하려면 각각 따로 요청을 보내야 합니다.

### Q2: 이미지 파일 형식은 어떤 것이 지원되나요?
**A**: JPG, PNG, BMP 등 일반적인 이미지 형식을 지원합니다.

### Q3: 시간대는 어떻게 설정되나요?
**A**: 기본적으로 "Asia/Seoul" 시간대로 설정됩니다.

### Q4: 일정이 중복으로 등록되나요?
**A**: 시스템은 중복 체크를 하지 않으므로, 같은 일정을 여러 번 요청하면 중복 등록될 수 있습니다.

### Q5: 무료 사용량은 얼마나 되나요?
**A**: 
- **Google Calendar API**: 무제한 (일일 할당량 있음)
- **CLOVA OCR**: 월 1,000건 무료 (표 인식 기준)

### Q6: 서버를 종료하려면 어떻게 하나요?
**A**: 터미널에서 `Ctrl+C`를 누르면 서버가 종료됩니다.

---

## 📞 지원 및 문의

### 로그 확인
- 서버 실행 시 터미널에 출력되는 로그를 확인하세요
- 에러 메시지를 정확히 기록하여 문제 해결에 활용하세요

### 추가 도움
- Google Cloud Console 도움말: https://console.cloud.google.com/
- 네이버 클라우드 플랫폼 도움말: https://www.ncloud.com/
- CLOVA OCR API 문서: 네이버 클라우드 콘솔 내 문서 참조

---

**🎉 이제 근무일정표 이미지만 업로드하면 Google Calendar에 자동으로 일정이 등록됩니다!** 